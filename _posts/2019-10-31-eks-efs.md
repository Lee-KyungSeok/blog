---
layout: post
comments: true
title:  "[AWS] EKS 에서 Shared Vloume(EFS) 사용하기"
date:   2019-10-31
author: Cory
categories: AWS
permalink : /dev/aws/eks-efs
tags: eks kubernetes aws efs
---

# 작성중.....

kubernetes 를 이용하다보면 모든 컨테이너에서 동일한 volume 을 사용해야 하는 경우가 생깁니다. 예를 들어 wordpress 같은 경우 동일한 HTML 파일을 가지고 있어야 사용자에게 동일한 화면을 보여줄 수 있으며, 필자가 주로 개발하는 __Hyperledger Fabric__ 의 경우 모든 peer, orderer 등 다른 node 들이 __crypto__ 파일을 공유할 수 있어야 합니다.

그냥 쉽게 __EBS 볼륨__ 을 사용하면 되지 않나 생각할 수도 있지만 EBS 의 경우 아래 그림처럼 __Available Zone__ (가용영역) 내에서 생기는 스토리지이기 때문에 서로 다른 가용영역에서는 공유할 수 없는 문제가 생깁니다. 즉, 쿠버네티스를 사용하면 어떤 pod 가 어떤 가용영역에 들어갈 지 모르기 때문에 모든 pod 가 동일한 volume 을 share 하고 싶다면 특별한 방법을 사용해야 합니다.

<img src="/assets/aws/eks-efs/01-eks-efs-intro_01.png" alt="intro_01">

즉, 모두 공유할 수 있는 Storage 인 __EFS__ 를 사용해야 합니다. 하지만 아래 그림(참고: [udemy 강의](https://www.udemy.com/course/amazon-eks-starter-kubernetes-on-aws/))에서 보듯이 EFS 와 EKS 는 서로 분리되어 있는 컴포넌트 이기 때문에 따로 생성해주어야 합니다. 그로 인해 조금 다른 구조를 띄게 됩니다. 다시 말하자면, 보통 PV 를 사용할때와는 다른 프로세스를 거쳐야 하는데 아래 그림에서 볼수 있는 각각의 컴포넌트 생성 과정인 __1) EFS 를 생성, 2) provisioner deployment 생성, 3) storageclass 생성, 4) 만든 storage 에 PVC 생성__ 이라는 과정을 거쳐야 합니다.

<img src="/assets/aws/eks-efs/01-eks-efs-intro_02.png" alt="intro_02">

그럼 이제 한 단계씩 만들면서 EFS 를 어떻게 구성하는지 알아보도록 하겠습니다.

## EFS 생성

## 마무리


